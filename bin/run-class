#!/bin/bash
set -e

# Utility script that caches the classpath from the vercors project, and
# proceeds to run a class from the arguments. Other scripts in this directory
# refer to this script to run classes from the vercors project.

SCRIPT=$(realpath $0)
BIN=$(dirname $SCRIPT)
ROOT=$(dirname $BIN)
CLASSPATH="$ROOT/target/streams/compile/fullClasspath/_global/streams/export"
if [ ! -f "$CLASSPATH" ] || [ ! -s "$CLASSPATH" ]; then
    printf "Extracting classpath from SBT. This might take a moment.\n"
    (cd $ROOT && sbt --error "show Compile / fullClasspath")
    printf "Classpath extracted\n"
fi

CLASSPATH=$(cat "$CLASSPATH" | tr -d "\n\r")
java $MORE_JAVA_OPTS -Xss128M -cp $CLASSPATH "$@"
